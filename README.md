# Rails with Rspec

When we are going to create a project Rails, where will use others libs/gems for testing, we don't need the mini-test which is the default generated by Rails.

For this we ignore the tests at the time of project generation:

````
rails g rails_tdd -T
````
The capital T indicates that the project will be created without testing by default.

## Adding Gems needed

We neeed to add in our Gemfile the following gems:

````
group :development, :test do
  # Rspec to Rails
  gem 'rspec-rails', '~> 3.6'
  # Capybara gem
  gem 'capybara'
end


group :development do
  # This gem is necessary to generate the binary of rspec in folder bin from application. 
  # To get more speed with commands in rspec when we run bin/rspec rather rspec.
  gem 'spring-commands-rspec'
end
````

Let's understand a litte about this gems

- rspec-rails: creates the configuration files needed for Rspec work in hamony with the project. It's needed add the gem Capybara as depedency to Rspec work perfectly.
- capybara:
- spring-commands-rspec: creates the binary for Rspec in main project folder. This way we gain more velocity when we run the command bin/rspec like bin/rails.


#### Adding the factory_bot_rails gem

Nos iremos trabalhar com as "Fábricas de dados", usaremos para isso a gem factory_bot_rails, dentro do grupo development e test.

````
group :development, :test do
  # Rspec to Rails
  gem 'rspec-rails', '~> 3.6'

  # Capybara gem
  gem 'capybara'

  # factory bot (factory girl)
  gem 'factory_bot_rails', '~> 4.0'
end
````

Logo depois adicionaremos no spec/rails_helper.rb a seguinte configuração:

> config.include FactoryBot::Syntax::Methods

Por padrão as factories ficam dentro do diretorio test/factories ou spec/factories, como estamos usando o Rails, entao deveremos criar a pasta factories dentro da pasta spec.

As factories deveram ser um arquivo .rb (ruby) e conter o mesmo nome das entidades a serem criadas as factories.

Um ex. de nossas factories:

````
FactoryBot.define do
  factory :customer do
	  name "Diego"
		email "contato@diegonovais.com.br"
	end
end
````

Para usarmos as factories, podemos usar usando

> build(:nome_da_factory)

O build ele apenas instancia o objeto, atribuir os valores definidos na factory e não salva.

> create(:nome_da_factory)

Ja o create ele ira criar as instancia, atribuir os valores e salvar.

Notamos que para nossa facrica, os dados serão sempre os mesmos que nós passamos, e nós não queremos isso, queremos que seja criado dados aleartórios, ou seja de forma dinâmica. Para isso iremos usar a gem faker dentro do grupo de development e test.

> gem faker

e não podemos esquecer de rodar bundle install ou apenas bundle.

Para usar a gem podemos fazer da seguinte forma em nosso factory para customer:

````
FactoryBot.define do
	factory :customer do
		name Faker::Name.name
		email Faker::Internet.email
	end
end
````

e nosso teste poderia ser:

````
require 'rails_helper'

RSpec.describe Customer, type: :model do
	context 'Customer' do
		it '#full_name' do
			customer = create(:customer)
			expect(customer.full_name).to start_with("Sr. ")
		end		
	end
end
````
